Према поставци задатка, коњ се, из произвољне тачке, може кретати хоризонтално, вертикално, као и (анти-)дијагонално. Додатно ограничење је да се коњ, полазећи из неке тачке, искључиво креће по дводимензионалној решетки путева, односно мрежи тачака које су међусобно удаљене $с$ једна од друге. Није тешко увидети да из одређене тачке у којој се тренутно налази, коњ може проћи кроз било коју другу тачку која се налази на поменутој решетки путева.

## Квадратно решење за 65 поена

Довољно је у две угнежђене петље проћи по свим шталама и испитати да ли је могуће доћи од једне до друге, рачунајући да се од $i$-те до $j$-те штале (наравно, само за индексе $i \neq j$) може доћи ако им се поклапају хоризонталне ($x$) или вертикалне ($y$) координате или се пак поклапа разлика или збир вертикалних и хоризоналних координата (то јест налазе се дијагонално/антидијагонално једна од друге), при чему се 4 поменутих једнакости (једнаке вредности $x$, $y$, $x-y$, $x+y$) рачунају по модулу $c$ уз услов да модуо буде позитиван. Како се у свакој од две петље пролази кроз све штале и чува максимум, ово решење има квадратну временску сложеност, односно $\mathcal{O}(n^2)$, где $n$ представља број штала.

## Главно решење у линеарној сложености

Да би се задатак урадио на ефикасан начин, сврсисходно је макар привидно пресликати дводимензионалну раван $(x, y)$ на матрицу димензија $c \times с$. Пресликавање се врши тако што се поље у $i$-тој врсти и $j$-ој колони поменуте матрице попуњава са онолико штала колико их се налази на координатама $x \mod c = i$ и $y \mod c = j$. Све што је тада потребно учинити јесте пронаћи поље у матрици са највећим збиром осталих елемената који се налазе у истој врсти и колони, као и на истој дијагонали и антидијагонали, тачније сам збир поменутих елемената са тренутним пољем који заправо представља тражено решење задатка. Приликом проласка кроз матрицу треба бити пажљив и обратити пажњу да се само поље кроз које се пролази не урачуна више пута, као и то да се, за парно $c$, поља на (продуженој) дијагонали и антидијагонали могу поклапати, односно да се (продужене) дијагонале могу сећи. Како је сама операција пресликавања равни на матрицу линеарна по $n$, то јест $\mathcal{O}(n)$, а пролазак кроз матрицу у општем случају квадратан по њеним димензијама, прецизније $\mathcal{O}(c^2)$, јасно је из поставке задатка у којој се каже да је $n\leq200'000$, а $c\leq100$, па је $n>c^2$, први члан доминантан, те је и укупна временска сложеност решења, под оваквим претпоставкама, линеарна по броју штала.

## Алтернативно решење

Како је услов да се из тачке $(x_1,y_1)$ тачка $(x_2, y_2)$ може обићи: $x_1 = x_2 \lor y_1 = y_2 \lor x_1-y_1 = x_2-y_2 \lor x_1+y_1 = x_2+y_2$, где је једнакост по модулу $c$, то можемо за сваку тачку тражити број тачака за који важи овај услов као број елемената уније 4 скупа (скуп свих са одређеном $x$ или $y$ координатом, или одређеном разликом/збиром двеју координата). Ово се може решити формулом укључења-искључења за 4 скупа, где величине пресека бројимо вишедимензионалним матрицама (укупна меморијска сложеност је $\mathcal{O}(c^4)$, што је у пракси и доста мање од $512$ МБ, док је временска линеарна јер сваку шталу убацујемо у константан број скупова који служе за пребројавање).
