
## Решење када $N \leq 20$

Ово је класичан задатак из динамичког програмирања са битмаскама - тражење најдужег пута у графу. Имамо динамичко програмирање $dp[i][mask]$, где је  $i$ представља чвора до ког смо стигли, а $mask$ је битмаска која представља које смо чворове посетили до сад.
Сложеност $O(N^2\cdot2^N)$ 
## Решење када нема тура

У овом случају, дати граф је стабло, а решење у том случају је познато: можемо или радити динамичким програмирањем, или напросто кренемо од произвољног чвора и нађемо од њега најдаљи, а затим од тог најдаљег нађемо најдаљи, што ће нам дати најдужи пут.

## Како даље?

Сада треба да нађемо неку озбиљну стратегију како да тражимо најдужи пут. У ту сврху ћемо пронаћи блокове нашег графа. То су максимални подскупови чворова тако да у тим скуповима нема артикулационих тачака. За ово постоји генерални алгоритам, али у нашем случају то може да се уради лакше. Наиме, пустимо претрагу по дубили (DFS) у нашем графу, и за сваку грану ван стабла узмемо пут на стаблу који спаја њене крајеве (који је дужине $3$ због услова са дужинама циклуса) и утрвдимо да су те $4$ гране у истом блоку (свака грана је највише у једном блоку). Када тако нађемо све могуће четворке, транзитивно затворимо релацију "у истом блоку" (у преводу, направимо граф над гранама и у њему нађемо повезане компоненте - чворови које оне обухватају нам представљају блокове графа). Спорије имплементације овог дела су обухваћена подзадатком $N\le2500$.

Сада, у произвољном графу можемо увести појам *block-cut* стабла тако што избацимо све гране које су део неког блока и онда за сваки блок направимо нови чвор који је повезан са свим чворовима у том блоку. Ово је интересантно, јер ако је почетни граф повезан, онда нам је block-cut стабло заиста стабло (ако није повезан онда је у питању шума). Сваки пут у овом графу може да се преслика у пут на block-cut стаблу, само сваки фрагмент пута који представља кретање унутар једног блока заменимо са путем од почетног до чвора који представља тај блок, и онда од тог до завршног.

Сада нам је циљ да  модификујемо block-cut стабло. За сваки блок желимо да пронађемо стабло тако да су нам чворови блока листови, и да је најдужи пут од $u$ до $v$ унутар блока једнак дужини пута од $u$ до $v$ у нашем стаблу. Ако сваки блок чвор у block-cut стаблу заменимо са овом мрежом која енкодира оптимизацију тражења најдужег пута на оном фрагменту пута који се налази унутар стабла, онда нам се задатак само своди на претходни подзадатак - тражење најдужег пута на стаблу (овде конкретно на том нашем модификованом block-cut стаблу), јер сваки пут у стаблу можемо на исти начин да пресликамо на пут на модификованом block-cut стаблу, а по конструкцији ће се најдужи пут пресликати у пут исте дужине.

Сада нам треба детаљан опис блокова нашег графа. За то нам треба следећа лема:
*Лема: Сваки блок у нашем графу је комплетан бипатритиван граф где је једна партиција величине $2$*.
**Доказ:** Пошто сваки циклус парне дужине, граф је бипартитиван - нека је у нашем блоку $b$ белих и $c$ црних. Могуће је доказати да унутар блока, за сваке две гране постоји циклус који их садржи. Претпоставимо да постоје црни чвор $u$ и бели чвор $v$ који нису спојени граном, и нека из њих излазе гране $ua$ и $vb$. По претходно наведеном, постоји циклус који садржи, а то једино може бити циклус $u-a-b-v$, тако да су $u$ и $v$ ипак повезани граном, па је граф комплетан и бипартитиван. Најзад, онда тривијално постоји циклус дужине $2\min(b,c)=4$, па је заиста у једној партицији само $2$ чвора.  

Сада смо већ близу краја. За конструкцију наших стабала разликујемо два случаја (и то баш они из подзатака!!)

## Свака грана се налази у највише једном циклусу
У овом случају су  нам блокови само $K_{2,2}$ то јест циклуси дужине $4$. Посматрајмо циклус $a-b-c-d$, ту супротни на циклусу треба да буду на дистанци $2$, а суседни на циклусу треба да буду на дистанци $3$. Додајмо чворове $e$ и $f$ и повежемо парове $a-e$, $c-e$, $b-f$, $d-f$ и $e-f$. Лако се проверава да је ова конструкција баш оно што смо тражили.
## Свака грана која се налази у једном циклусу се налази у барем два циклуса
У овом случају су  нам блокови само $K_{2,t}$ са $t\ge3$, нека су нам ова $2$ чвора бела, а осталих $t$ црни. Можемо да видимо да најдужа путања између $2$ црна чвора дужине $4$, између црног и белог дужине $3$ и између два дела дужине $2$. Зато је довољно да узмемо један нови чвор који спојимо са свим белима директно граном, а са свим црнима путем дужине $2$.

## Главно решење
Напросто спојимо конструкције из предхотна два случаја, и онда на добијеном стаблу нађемо најдужи пут.
Сложеност $O(N)$.
