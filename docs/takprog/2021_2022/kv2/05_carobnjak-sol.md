## Решење за $N \leq 10$

У овом случају можемо за сваки одабир $K$ од $N$ елемената испробати све могуће начине да извршимо операције. Временска сложеност је $O({N \choose K} \cdot 2^K)$.

## Решење за $N \leq 200$


У овом подзадатку до решења можемо доћи применом динамичког програмирања. Дефинишимо $dp[l][r][p][g][h]$ на следећи начин:

 - За $g=0, h=0$ највећа вредност тако да у низу напитака остане напитак са том моћи, па онда напици из интервала $[l,r]$ и да смо изван интервала одабрали да задржимо $p$ елемената.
 - За $g=0, h=1$ најмања вредност тако да у низу напитака остане напитак са том моћи, па онда напици из интервала $[l,r]$ и да смо изван интервала одабрали да задржимо $p$ елемената.
 -  За $g=1, h=0$ највећа вредност тако да у низу напитака остане напитак са том моћи, пре њега напици из интервала $[l,r]$ и да смо изван интервала одабрали да задржимо $p$ елемената.
  - За $g=1, h=1$ најмања вредност тако да у низу напитака остане напитак са том моћи, пре њега напици из интервала $[l,r]$ и да смо изван интервала одабрали да задржимо $p$ елемената.

Како се операцијама искључиво одузима вредност једног краја од вредности другог, то се проналажење максималне или минималне вредности на једном крају управо своди на проналажење минималне односно максималне вредности на супротном и примену једне операције. Ово динамичко програмирање је временске сложености $O(N^3)$.

## Решење за $K = N$

За решавање овог подзадатка, неопходно је приметити да су све вредности моћи напитка који остаје последњи у низу или разлика непразног префикса и одговарајућег непразног суфикса или разлика непразног суфикса и одговарајућег непразног префикса. За почетак, приметимо да моћ напитка који остаје последњи у низу увек можемо пресликати на низ $b$ који садржи $N$ вредности које су искључиво $+$ или $-$. Конкретно, ако моћ неког напитка из почетног низа учествује са знаком $+$ у моћи напитка који остаје последњи, на ту позицију у низу $b$ стављамо $+$, а у супротном $-$. Посматрајмо сада низ $b$. Желимо да га сведемо на низ који има само један елемент и тај елемент има вредност $+$, применом операција дефинисаних у тексту. Приметимо да уколико прва и последња вредност у низу $b$ имају исти знак, тада сигурно није могуће извршити ни једну операцију, јер тада желимо да и први и последњи елемент учествују са истим знаком, а знамо да применом било које од две операције доводимо до тога да у коначној суми учествују са различитим знаком. У супротном, можемо да извршимо било коју од ове две операције. На низу $b$ ово се одржава брисањем једног од два краја. Дакле, уколико после примене неких операција дођемо до низа који има више од једног елемента и његови крајеви су различитог знака, онда нас тај низ никако не може довести до низа који садржи само један елемент $+$. Због тога није могуће да у низу $b$ постоји више од једног пара суседних позиција које имају супротан знак. Дакле, довољно је да узмемо максимум разлика свих непразних префикса и одговарајућих непразних суфикса, односно непразних суфикса и одговарајућих непразних префикса. Ово је могуће урадити у  временској сложености $O(N)$.

## Решење кад $N \leq 1000$

Решавање овог подзадатка се надовезује на решавање претходног. Фиксираћемо сваку позицију која ће представљати разлику између префикса и суфикса (односно суфикса и префикса) и потом избацити $N-K$ елемената тако да се та разлика максимизује и да ни префикс ни суфикс не остану празни. Ово је могуће постићи сортирањем целог низа са промењеним знаком елемената у суфиксу, те избацивањем најмањих $N-K$ елемената. Неопходно је само водити рачуна да избацивање тих елемената не доведе до празног префикса или суфикса. Овакво решење је временске сложености $O(N^2 \log N)$.

## Главно решење

За решење целог задатка, неопходно је оптимизовати решење претходног подзадатка тако да не морамо да за сваку позицију сортирамо низ и поново бирамо најмање елементе. Главна идеја у тој оптимизацији се заснива на томе да се променом позиције која раздваја префикс и суфикс за један мењају тачно две вредности из низа који сортирамо и из којег бирамо најмањих $N-K$. Можемо користити структуру `set` или сегментно стабло да би одржавали тај низ. Решење комплетног задатка је временске сложености $O(N \log N)$.
