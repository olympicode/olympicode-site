
# Решења неких потпроблема

Најпре ћемо почети са неколико потпроблема који не воде нужно ка финалном решењу.

## Свака тачка је повезана са највише две друге тачке.

Није тешко видети да је ово стабло заправо прост пут. Пошто сваки чвор има највише два суседа, боје које долазе у обзир су само 1 или 2. Знамо да оба краја пута морају имати боју 1, па није толико тешко размотрити све случајеве за остале бројеве у зависности од дужине пута [Помоћ 1].

## $N\leq20$

Овај потпроблем могуће је решити једноставним бектрек алгоритмом. За сваки чвор испробамо све могућности за његове боје. Пробајте доказати да је укупна сложеност овакве имплементације одозго ограничена производом степени чворова и да овај производ никада не премашује $2^20$ [Помоћ 2].

# Решења потпроблема коришћењем динамичког програмирања

Идеја је рачунати матрицу динамичког програмирања где су могућа стања означена са $dp[r][i][c]$. Прва димензија $r \in \{0, 1\}$ означава нулом да родитеља није потребно бојити истом бојом, а јединицом да је родитеља потребно обојити истом бојом. Друга димензија $1 \le i \le N$ означава чвор који се тренутно разматра, док на крају трећа димензија $1 \le c \le N$ означава боју која се тренутно разматра. Вредности у матрици биће 0 уколико је конфигурација изводљива и 1 уколико није. Претпоставићемо да је стабло укорењено у неком чвору (рецимо чвору $1$) и обилазићемо стабло рекурзивно, тако да се $dp$ вредност чвора рачуна након $dp$ вредности његових наследника. Уколико је стабло могуће обојити вредност $dp[0][1][c]$ биће 1 за неку од боја $c$.

## $N\leq500$

За сваки чвор $i$ и сваку боју $c$, пролазимо по свим наследницима чвора и проверавамо за сваког од њих да ли га је могуће обојити у $c$ (овај тип наследника зовемо <em>истобојни</em> наследници за боју $c$), да ли га је могуће обојити у неку другу боју (овај тип наследника зовемо <em>разнобојни</em> наследник за боју $c$), као и да ли га је могуће обојити у исту и у различиту боју (овај тип наследника зовемо <em>шарени</em> наследник за боју $c$). На основу броја истобојних, разнобојних и шарених наследника, могуће је утвридити $dp[0][i][c]$, као и $dp[1][i][c]$.

## $N\leq3000$

Мало пажљивија имплементација рачунања $dp$ табеле довољна је за све поене на овом потпроблему. Наиме, за сваки чвор $i$, пролазимо по свим бојама $c$ и по свим суседима. Укупна сложеност је $\sum_{1 \le i \le N} \deg(i)^2 = O(N^2)$. Пробајте видети зашто [Помоћ 3].

## Свака тачка је повезана са највише $10$ других тачака.

Приметимо да највећа боја коју било који чвор може имати није никада већа од његовог степена. Уколико знамо да највећи степен никада не премашује 10, тада трећа димензија $dp$ табеле има највише 10 колона. Решење из претходног потпроблема сада ради у сложености $N \cdot d^2$, где је $d \le 10$ највећи степен у стаблу.

## Решење за све поене

Идеја из претходног потпроблема биће корисна и у овом потпроблему. Уколико за сваки чвор $i$ направимо трећу колону $dp$ табеле да буде величине $\deg(i)$, тада ће укупна величина ове матрице увек бити линеарна по $N$. Такође, приметимо да за сваки чвор можемо одредити да ли ће бити истобојни, разнобојни или шарени наследник за боју $c$ одмах након што смо израчунали све вредности његове $dp$ табеле. Претпоставимо да сваки чвор садржи информацију о броју наследника сваког од три могућа типа за сваку од могућих боја. Када за неки чвор одредимо ког је он типа, једноставно можемо ажурирати бројач његовог родитеља у стаблу за сваку боју $c$. На тај начин, родитељ може у константној временској сложености одредити за сваку од боја колико има наследника ког типа па самим тим и која је $dp$ вредност за ту боју.

## Joш једно интересантно решење

Приметићемо да боје које су могуће за сваки чвор јесу само оне од $1$ до $\sqrt{N}$, као и од $N - \sqrt{N}$ до $N$. Пажљиво имплементирано решење потпроблема када је степен највише $10$ и коришћење ове идеје било је довољно за све поене на овом задатку.





[Помоћ 1]: Посматрајте дељивост са 3.

[Помоћ 2]: Користите неједнакост између аритметичке и геометријске средине.

[Помоћ 3]: Колики је збир степенова свих чворова?

[Помоћ 4]: Шта се дешава ако важи да боја неког чвора није у том опсегу? Колико он има истобојних наследника и колико они укупно имају истобојних наследника?
