**Анализа проблема**

Праволинијско решење се добија тако што се утакмице нумеришу, нпр. бројевима од $0$ до $N\cdot M - 1$ (ако су лиге нумерисане бројевима од 1 до $N$, а утакмице у оквиру сваке лиге бројевима од 1 до $M$, онда ће утакмица  $j$ из лиге број $i$ бити нумерисана бројем $(i-1)\cdot M + (j-1)$) и након тога сваки тикет посматра као подскуп скупа $\{0, 1, 2, ..., N\cdot M - 1\}$. Приметимо да не мора сваки подскуп скупа  $\{0, 1, 2, ..., N\cdot M - 1\}$ представљати исправан тикет: може се десити да је из неких лига изабран недозвољен број утакмица.
Но без обзира на то, подскупови се могу репрезентовати помоћу целих бројева између 0 и $2^{N\cdot M}-1$. Сваки број из тог опсега се може записати у бинарном бројном систему са највише $N\cdot M$ цифара (битова). Ако запис има мање од $N\cdot M$ цифара допуни се нулама (са леве стране). Цифра нула на месту одређене тежине означава да утакмица чија се ознака поклапа са тежином није изабрана у подскуп (на тикет), а цифра 1, да је одговарајућа утакмица изабрана у подскуп (на тикет). Према томе, потребно је од броја формирати тикет, проверити да ли је тикет исправан (валидан), ако јесте, одредити добитак и додати на збир добитака. Сложеност овог решења је $\Theta(N\cdot M \cdot 2^{N\cdot M})$. Ово представља решење подзадатка 1.

Подзадатак 3 се такође може решити на посебан начин. Претпоставимо ради поједностављења да имамо само две лиге. Из сваке лиге је могуће узети по једну утакмицу, а добитак се рачуна као производ квота за изабране утакмице и бонуса за тикет са две утакмице. За сваки тикет ће бонус бити исти (јер сваки тикет има тачно две утакмице), па се због тога могу прво израчунати само производи квота за тикете, сабрати и на крају помножити са бонусом. Као што смо рекли, исправне тикете чине све комбинације састављене од по једне утакмице из обе лиге. Због дистрибутивности множења у односу на сабирање, збир производа квота за све могуће тикете ће бити једнак производу збира квота за прву лигу и збира квота за другу лигу. Ово се може поопштити и на случај када постоји више од две лиге, па се збир свих добитака може одредити тако што се помноже збирови квота за све лиге и то на крају помножи са бонусом (увек исти број - број одиграних утакмица је једнак броју лига). Сложеност овог решења је $\Theta(N\cdot M)$.

Опишимо решење које "покрива" све подзадатке. Претпоставимо опет да имамо само две лиге. Ако је дозвољено из прве лиге узети $k_1$ утакмица, а из друге лиге $k_2$ утакмица, онда се било који подскуп од $k_1$ утакмица из прве лиге може комбиновати са било којим подскупом од $k_2$ утакмица из друге лиге, а добитак ће се рачунати као производ квота изабраних утакмица и бонуса за $k_1+k_2$ одиграних утакмица. Како је бонус увек исти, може се опет рачунати само збир производа квота, па на крају добијени збир помножити са бонусом. Због дистрибутивности, збир производа се може добити тако што се саберу сви производи од по $k_1$ квота за прву лигу, односно сви производи од по $k_2$ квота за другу лигу и на крају та два збира помноже. Ако би било више од две лиге, онда би се опет збирове производа (са истим бројем одиграних утакмица) за поједине лиге множили и након тога множили  са одговарајућим бонусом . Према томе,  потребно је за почетак за сваку лигу $i$ и сваку вредност $j\in\{1, 2, ..., M\}$ одредити збир свих производа квота за тачно $j$ утакмица одиграних у лиги $i$ (означимо те збирове са $pr_{ij}$).
 
Изразе  $pr_{ij}$ ћемо израчунати користећи динамичко програмирање. Нека је $pr_{i,j}^{(k)}$ збир свих производа квота од тачно $j$ утакмица из лиге $i$, при чему  сви подскупови садрже само утакмице са редним бројевима између 1 и $k$ (наравно не нужно све). Тада ће $pr_{i,j}^{(М)}$ бити збир свих могућих производа квота од по $j$ утакмица у лиги број $i$.
Лако се може закључити да је
$$
pr_{i,j}^{(0)}=\begin{cases}
1, &\text{ако је }j=0\\
0, &\text{ако је }j > 0
\end{cases}.
$$

Што се тиче збира свих производа квота за тачно $j$ утакмица где је свих $j$ утакмица из скупа $\{1, 2, ..., k, k+1\}$, приметимо да постоје две могућности:

 - Свих $j$ изабраних утакмица су из скупа $\{1, 2, ..., k\}$, тј. није изабрана утакмица $k+1$,
 -  Једна од изабраних утакмица је баш $k+1$. Онда је преосталих $j-1$ утакмица из скупа $\{1, 2, ..., k\}$. При томе се сваки тикет са $j-1$ утакмицом може проширити до тикета са $j$ утакмица додавањем утакмице $k+1$. Због дистрибутивности множења у односу на сабирање, збир свих производа са $j$ изабраних утакмица, где је последња баш утакмица $k+1$ биће једнак производу квоте за ту утакмицу $k+1$ и збира производа свих тикета са $j-1$ утакмицом (где су све те утакмице из скупа $\{1, 2, ..., k\}$ .

На основу овог разматрања може се извести формула за израчунавање збирова: 
$$
pr_{i,j}^{(k+1)}=\begin{cases}
pr_{i,j}^{(k)} + pr_{i,j-1}^{(k)} \cdot q_{i,k+1}, &\text{ако је }j\leq k+1\\
0, &\text{ако је }j > k+1
\end{cases}.
$$
У горњем изразу $q_{i,k+1}$ представља квоту за утакмицу $k+1$ у лиги $i$.

Када имамо збирове производа са фискираним бројем утакмица за сваку лигу, онда сличним поступком одређујемо збирове производа квота на тикету који садржи утакмице из разних лига. Означимо са $gpr_{k,j}$ збир производа свих тикета који имају тачно $j$ утакмица из првих $k$ лига.
Тада ће важити да је
$$
gpr_{1,j}^{(1)} = pr_{1,j}.
$$
Лако се закључује да ако из првих $k+1$ лига треба избрати тачно $j$ утакмица, то можемо урадити тако што из лиге број $k+1$ изаберемо било који дозвољени број утакмица (не већи од $j$) а остатак допунимо из првих $k$ лига. Ми већ имамо израчунате збирове производа квота за све могуће бројеве утакмица на тикету. Ако уведемо ознаке 
$$
c_{i,j} = \begin{cases}
1,&\text{ може изабрати тачно  $j$ утакмица из лиге $i$}\\
0,&\text{ не може се изабрати тачно  $j$ утакмица из лиге $i$}
\end{cases},
$$
онда се $gpr_{k+1,j} $ може рачунати на следећи начин
$$
g_{k+1,j} = \sum_{j'=1}^{\min(M,j)} c_{k+1,j'}\cdot pr_{k+1,j'}\cdot gpr_{k,j-j'}
$$
Након одређивања свих поменутих збирова производа потребно је само одговарајуће збирове помножити са бонусима и сабрати:
$$
\sum_{j}^{N\cdot M} F_j \cdot gpr_{N,j}
$$
Овде је са $F_j$ означен бонус за тикет са $j$ утакмица.

Напоменимо да се све операције изводе по модулу $10^9+7$, тј. сваки пут после изведене операције (сабирање или множење) се одређује остатак при дељењу са $10^9+7$.

На крају, пар речи о сложености поступка. Сложеност рачунања матрице $pr$ је $O(N\cdot M^2)$, а сложеност рачунања матрице $gpr$ је $O(N^2\cdot M^2)$.

**Алгоритамске смернице**




> Written with [StackEdit](https://stackedit.io/).