
## Анализа

Прво направима два геометријска закључка.

* Уколико бисмо рекли да грб треба да буде конвексан четвороугао који има као три темена тачке једне а као преостало теме тачку друге боје број начина за исцртавање грбова не би се разликовао од оног траженог у задатку.
* Уколико би се почетне црне и беле тачке налазиле у теменима произвољног конвексног многоугла број начина за исцртавање грбова не би се разликовао од оног траженог у задатку.

Дакле када одаберемо четири тачке које ћемо повезати током цртања једног грба оне деле преостале тачке на четири групе (неке од којих су потенцијално празне) наиме на четири циклична сегмента почетног низа тачака. 

Како сада не могу постојати дужи које спајају тачке из различитих група сваки нови грб који нацртамо (односно његова темена) налазиће се тачно у једној од група, а како тачке сваке групе опет чине конвексан многоугао видимо да је проблем налажења броја начина да се нацртају грбови користећи темена неке групе у ствари аналоган почетном проблему.

Решимо сада проблем динамичким програмирањем, дефинишимо:

* $d[i][j][0]$ - број начина да се на цикличном сегменту $[i, j)$ (укључује $i$, не укључује $j$) нађе тачка $s$ боје $0$ и да се тачке сегмената $[i,s)$ и $[s + 1, j)$ споје у грбове (сваки грб (односно његова темена) да се налазе тачно у једном од сегмената, у $[i,s)$ или у $[s + 1, j)$)
* $d[i][j][1]$ - аналогно само за $s$ боје $1$
* $d[i][j][2]$ - број начина да се тачке сегмената $[i, j)$ споје у грбове.

Пре него што почнемо приметимо да $d[i][j][0]$ и $d[i][j][1]$ могу бити не нула само уколико је дужина (број тачака) у цикличном интервалу $[i, j)$ облика $4k + 1$, док $d[i][j][2]$ може бити не нула само уколико је уджина тог интервала облика $4k$.

Наши почетни услови су 

* За свако $1 \leq i \leq n$, $d[i][i][2] = 1$
* За свако $1 \leq i \leq n$, $d[i][i + 1][a[i]] = 1$
* За сваке $i, j, k$, $d[i][j][k] = 0$ сем за горе поменуте

Остаје још да прођемо кроз све интервале, сортиране по дужини (броју тачака у њима).

Сада кадa рачунамо $d[i][j][0]$ јасно је да за сваки $s$ из интервала $[i, j)$ такав да $A[s] = 0$, требамо $d[i][j][0]$ да увећамо за $d[i][s][2] * d[s + 1][j][2]$, по дефиницији.

Аналогно за $d[i][j][1]$.

У случају рачунања $d[i][j][2]$ знамо да је тачка $i$ у грбу са још три тачке назовимо ону која се у смислу цикличног поретка налази између друге две, односно "средњу" тачку, $s$. Уколико је она исте боје као тачка $i$ број начина да се тачке интервала $[i, j)$ споје у грбове на такав начин је по дефиницији $d[i + 1][s][0] * d[s + 1][j][1] + d[i + 1][s][1] * d[s + 1][j][0]$ (тачке које су неспарене у попуњавању мањих сегмената сада узимамо у исти грб са тачкама $i$ и $s$, и водимо рачуна о томе да су различитих боја), док аналогно уколико су $i$ и $s$ истих боја број начина је $d[i + 1][s][0] * d[s + 1][j][0] + d[i + 1][s][1] * d[s + 1][j][1]$.

Све претходно речено даје нам укупну сложеност $О(n^3)$.

## Додатак

Решење се може додатно убрзати уколико се примети да ао на сегменту $[i, j)$ има $a$ тачака боје $0$ и $b$ тачака боје $1$, систем једначина $3A + B = a$, $A + 3B = b$, мора имати ненегативна решења (уколико посматрамо да је $A$ број грбова којима је теме обојено бојом $1$, а $B$ број грбова којима је теме обојено бојом $0$ једначине директно следе). Овиме и аналогним условом за случајеве када рачунамо сегмент ком остављамо једну тачку негруписану можемо избећи беспотребне проласке кроз унутрашњу петљу алгоритма.

Такође имплементација алгоритма постаје значајно поједностављена уколико уместо цикличних сегмената датог низа посматрамо обичне сегменте двоструко дужег низа који бисмо добили уколико бисмо на крај нашег низа налепили још један идентичан, уз готово идентичне једначине.

