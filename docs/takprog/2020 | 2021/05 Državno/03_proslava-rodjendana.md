# Прослава рођендана

Аутор: Алекса Милисављевић
Текст и тест примери: Алекса Милисављевић
Анализа решења: Младен Пузић
Тестирање: Игор Павловић

### Решење за $N \leq 20$:
Можемо пробати сваки подскуп гостију. Узмемо максималан одговарајући подскуп. Временска сложеност: $O(2^N\cdot N)$, меморијска сложеност: $O(N)$. 

### Решење за $M=2$:
Желимо да одаберемо паран број људи и да они укупно донесу паран број поклона. Поделимо људе у две групе, оне које доносе паран број поклона и оне који доносе непаран број поклона. Сортирајмо људе у обе групе опадајуће по броју поклона. Ако имамо најмање две особе у некој групи, сигурно ћемо моћи без конфликта да позовемо две особе из те групе, а наравно ми ћемо одабрати две особе са највише поклона. Овај процес понављамо док нам у обе групе остане $0$ или $1$ особа. Тада стајемо, јер те људе не можемо позвати - или број званица неће бити паран, или укупан број њихових поклона. Временска сложеност: $О(NlogN)$, меморијска сложеност: $O(N)$.

### Решење за $1≤a_i≤2$:
Постоје само две врсте људи: људи који доносе један поклон и људи који доносе два поклона. Означимо са $k$ број позваних људи који доносе један поклон, а са $t$ број позваних људи који доносе два поклона. Мора важити да су $t+k$ и $2\cdot t + k$ дељиви са $M$. Фиксирајмо остатак при дељењу $t$ са $M$ и остатак при дељењу $k$ са $M$. Уколико важе наши услови, узећемо што веће $t$ и $k$ које задовољава дате остатке. Узимамо максимум од свих комбинација остатака. Временска сложеност: $O(M^2)$, меморијска сложеност: $O(1)$.


### Решење за $1≤N≤10000$:
Користимо динамичко решење, стање је $dp[i][j][k]$ и означава најбоље решење посматрајући првих $i$ људи, тако да је остатак при дељењу броја одабраних људи са $M$ баш $j$, а остатак при дељењу збира њихових поклона са $M$ баш $k$. За $i$-ти елемент важи да можемо или да га узмемо или не, па је рекурентна веза:
$$
dp[i][j][k] = max(dp[i-1][j][k], dp[i-1][j-1][k-a_i] + a_i).
$$
Битно је напоменути да је одузимање у овој рекурентној вези спроведено по модулу $M$, на пример $2-5$ по модулу $7$ је $4$. Последњи корак нам је да решење оптимизујемо меморијски, пошто нам тренутно заузима превише меморије. То можемо урадити тако што приметимо да кад рачунамо стања за $i$, користимо искључиво стања за $i-1$, па је увек довољно чувати само претходна стања. Временска сложеност: $O(NM^2)$, меморијска сложеност: $О(M^2)$.

### Главно решење:
 
Одвојимо госте у групе по остатку при дељењу њиховог број поклона са $M$. Имамо $M$ таквих група, једну за остатак $0$, једну за остатак $1$, ..., једну за остатак $M-1$. Сортирајмо опадајуће по броју поклона сваку групу. 

За сваку групу, највише $M-1$ људи неће бити позвани (уколико је макар $M$ људи непозвано, можемо да позовемо било којих $M$ непозваних људи, а да не нарушимо остатке при дељењу). То нам говори да ће сви гости у групи који нису у најмањих $M-1$ сигурно бити позвани, за остале морамо наћи оптимално решење.

У свакој групи имамо највише $M-1$ елемената које посматрамо, укупно немамо више од $M^2$ елеманата. На том броју елемената можемо применити решење за претходни подзадатак. Временска сложеност: $O(NlogN + M^4)$, меморијска сложеност: $O(M^2)$.