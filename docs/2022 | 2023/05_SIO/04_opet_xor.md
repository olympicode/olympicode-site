# 4 - Opet XOR

| Autor | Tekst i test primeri | Analiza rеšenja | Testiranje |
|:-:|:-:|:-:|:-:|
| Pavle Martinović | Dimitrije Erdeljan | Aleksa Milisavljević | Pavle Martinović |

## Rešenje kada je $Q \leq 10$, $X[i] \leq 10$ za upite tipa $2$
U ovom podzadatku možemo testirati sve moguće permutacije i proveriti da li su XOR-ovi svih prefiksa rastući. Složenost ovog rešenja $O(Q\cdot N!)$.

## Rešenje kada je $N, Q \leq 200$
Za ovaj podzadatak neophodno je da razmotrimo detaljnije kada je niz *ksortastičan*. Za početak, možemo da primetimo dodavanje elementa sa vrednošću $0$ na proizvoljnu poziciju ne utiče na monotonost prefiksnih XOR-eva, pa te elemente možemo da zanemarimo. Dodatno ćemo, zarad jasnije notacije, u objašnjenju ovog podzadatka pretpostaviti da je dat samo jedan upit na koji treba odgovoriti. Razmatraćemo sledeće gramzivo rešenje: iterativno gradimo permutaciju tako da naredni izabrani element prouzrokuje najmanji mogući prefiksni XOR, i da taj naredni prefiksni XOR još uvek bude veći od trenutnog. Neka je trenutni prefiksni XOR jednak $x$. Označimo sa $B_i$ poziciju vodećeg bita broja $A_i$. Neka je baš $A_i$ naredni odabrani elment. Da bi naredni XOR bio veći, u binarnom zapisu broja $x$ mora da stoji $0$ na poziciji $B_i$. Od svih narednih elementa koji zadovoljavaju ovaj uslov, dovoljno je da odaberemo onaj koji će što slabiju $0$ broja $x$ promeniti u $1$. Jedna od strategija koja rezultuje u ovakvom načinu biranja elemenata je upravo odabir elementa koji će što manje da poveća prefiksni XOR. Na intuitivnom nivou, možemo shvatiti da ovim izborom što manje većih pozicija na kojima su $0$ menjamo u $1$. Ova strategija će uvek proizvesti niz rastućih prefiksnih XOR-eva kad god je niz *ksortastičan*. Pretpostavimo da postoji rešenje u kojem na poziciji $j$ u permutaciji nije odabran element kojim se najslabija $0$ transformiše u $1$ i označimo tu poziciju na kojoj je najslabija $0$ sa $p$. Posmatrajmo u tom rešenju prvu poziciju $k > j$ u permutaciji nakon trenutne na kojoj se nalazi element $A_l$, takav da je $B_l = p$. Tada možemo da modifikujemo permutaciju tako što na poziciju $j$ postavimo $A_l$, a sve ostale elemente pomerimo za jedno mesto desno. Nakon toga, potrebno je još da razrešimo probleme koji su mogli nastati sa elementima $A_m$ koji su u permutaciji bili između $j$ i $k$ i takvim da $B_m < p$. Nakon ovog tehničkog detalja kojeg ostavljamo čitaocu, dobija se permutacija koja ima neopadajući niz prefiksnih XOR-eva, a element $A_l$ na poziciji $j$. Složenost ovog rešenja je $O(Q\cdot N^2)$.

## Rešenje kada $N, Q \leq 5000$
U prethodnom podzadatku smo primetili da je dovoljno odabrati element koji što slabiju $0$ trenutnog prefiksnog XOR-a transformiše u $1$. Dovoljno je da elemente čuvamo prema njihovom najjačem bitu i da iteracijom kroz sve pozicije na kojima su $0$ (počevši od najslabije) u binarnom zapisu trenutnog prefiksnog XOR-a odaberemo proizvoljan element koji ima $1$ kao najjači bit na toj poziciji. Složenost ovog rešenja je $O(Q\cdot N \cdot \log_2 \max_i A_i)$.


## Rešenje kada $A[i] < 64$.
Primetimo da su u ovom slučaju i prefiksni XOR-evi do $64$. Ukoliko niz iz upita ima više od $64$ pozitivne vrednost, odgovor je `false`. U suprotnom možemo da primenimo rešenje iz prethodnog opisanog podzadatka. Složenost ovog rešenja je $O(Q\cdot \max_i A_i \cdot \log_2 \max_i A_i)$.

## Rešenje kada $T[i] = 2$
Za ovaj podzadatak je neophodno da dalje optimizujemo proveru uslova iz gramzivog rešenja. Primetili smo da je bilo dovoljno birati proizvoljan broj koji ima najveći bit postavljen na poziciji što slabije $0$ iz trenutnog prefiksnog XOR-a. Sada je potrebno da vidimo kada ćemo uspeti da odaberemo sve takve brojeve. Odabirom tog broja se $0$ na toj poziciji promenila u $1$ u narednim prefiksnim XOR-evima. Da bi opet odabrali broj koji ima $1$ na toj poziciji, potrebno je da se ponovo u prefiksnom XOR-u nađe $0$. Dakle, za svako (osim poslednjeg) postavljanje tog bita na $1$ u aktuelnom prefiksnom XOR-u, potrebno je da ga kasnije resetujemo, postavljanjem na $0$. Označimo sa $p_i$ broj elemenata u kojima je bit na poziciji $i$ najjači, a sa $q_i$ broj elemenata u kojima je taj bit postavljen, ali ne kao najjači. Potreban i dovoljan uslov je da $q_i \geq p_i + 1$. Vrednosti $p_i$ i $q_i$ u nekom podnizu možemo pronaći korišćenjem prefiksnih suma. Složenost ovog rešenja je $O(Q \cdot \log_2 \max_i A_i)$.

## Glavno rešenje
Za glavno rešenje bi bilo neophodno i da vršimo ažuriranje tih prefiksnih suma. Ovo zahteva da koristimo fenvikovo stablo (tj. `bit`). U fenvikovom stablu za svako $i$ pamtimo i ažuriramo koliko elemenata u odgovarajućem intervalu ima $1$ kao najjači bit na poziciji $i$, a koliko njih ima $1$, ali ne kao najjači bit. Složenost ovog rešenja je $O(Q \cdot \log_2 \max_i A_i \cdot \log_2 N)$.